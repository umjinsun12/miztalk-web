<ion-header>
    <ion-navbar color="header">
      <ion-buttons end>
        <button ion-button icon-only light class="has-icon icon-only has-badge" (click)="getCart()">
          <ion-icon color="primary" class="ion-ios-cart-outline item-icon product-cart">
          </ion-icon>
          <ion-badge class="badge badge-light" *ngIf="values.count">{{values.count}}
          </ion-badge>
        </button>
      </ion-buttons>
    </ion-navbar>
</ion-header>


  <ion-content class="product-page">

      <ion-segment mode="md" [(ngModel)]="selectedSegment" (ionChange)="onSegmentChanged($event)">
          <ion-segment-button value="info">
            상품정보
          </ion-segment-button>
          <ion-segment-button value="review">
            상품후기
          </ion-segment-button>
      </ion-segment>


    <ion-spinner *ngIf="!product" name="crescent">
    </ion-spinner>
    <div *ngIf="product" class="product-details">
      <div *ngIf="product.product.images">
        <ion-slides pager="true" loop="true" autoplay="5800" class="product-image-slider">
          <ion-slide *ngFor="let item of product.product.images">
            <img src="{{item.src}}">
            <h2 *ngIf="!product.product.in_stock" item-right class="stock" color="danger">{{"OUTOFSTOCK"}}
        </h2>
          </ion-slide>
        </ion-slides>
      </div>
      
      
      <div class="product-title">
        <div class="product-title-inner">
          {{product.product.title}}
        </div>
      </div>
      

      <ion-item class="stock-label" no-lines>
        
        <ion-label class="price-regular" *ngIf="!product.product.sale_price">{{(1*product.product.price | currency:values.currency:false:'1.0-0').replace('KRW','')}}원
        </ion-label>
                      <ion-label class="price-special" *ngIf="product.product.sale_price">
                        <span text-wrap class="price-off-tag">{{(product.product.regular_price - product.product.sale_price) / product.product.regular_price*100 | number : '1.0-0'}}%</span>
                        <span class="price-off">{{(1*product.product.sale_price | currency:values.currency:false:'1.0-0').replace('KRW','')}}원</span>
                        <span class="price-delete"><del>{{(1*product.product.regular_price | currency:values.currency:false:'1.0-0').replace('KRW','')}}원</del></span>
                      </ion-label>
  
        <h2 *ngIf="values.wishlistId[product.product.id]" item-right class="wishlist" color="danger" (click)="removeFromWishlist(product.product.id)">
        <ion-icon color="primary" ios="ios-heart" md="md-heart"></ion-icon>
        </h2>
        <h2 *ngIf="!values.wishlistId[product.product.id]" item-right class="wishlist" color="danger" (click)="addToWishlist(product.product.id)">
        <ion-icon color="primary" ios="ios-heart-outline" md="md-heart-outline"></ion-icon>
        </h2>
       
      </ion-item>
      <!--variation product starts-->
      <div *ngIf="product?.product?.variations.length" class="variation-product">
        <ion-item class="variation-title">
          <strong>{{"Options"}}
          </strong>
        </ion-item>
        <ion-item>
          <ion-label>           
            {{"Variation"}}
          </ion-label>
          <ion-select [(ngModel)]="options[0]" (ngModelChange)="chnageProduct()">
            <div *ngFor="let option of product.product.variations">
              <div *ngIf="option.attributes.length == 1">
                <ion-option value="{{'variation_id:' + option.id + ':variation[attribute_pa_'+ option.attributes[0].name +']:' + option.attributes[0].option}}">{{option.attributes[0].option | uppercase}} - {{option.price | currency:values.currency:true:'1.2-2'}}
                </ion-option>
              </div>
              <div *ngIf="option.attributes.length == 2">
                <ion-option value="{{'variation_id:' + option.id + ':variation[attribute_pa_'+ option.attributes[0].name +']:' + option.attributes[0].option + ':variation[attribute_pa_'+ option.attributes[1].name +']:' + option.attributes[1].option}}">{{option.attributes[0].option | uppercase}} - {{option.attributes[1].option | uppercase}} - {{option.price | currency:values.currency:true:'1.2-2'}}
                </ion-option>
              </div>
              <div *ngIf="option.attributes.length == 3">
                <ion-option value="{{'variation_id:' + option.id + ':variation[attribute_pa_'+ option.attributes[0].name +']:' + option.attributes[0].option + ':variation[attribute_pa_'+ option.attributes[1].name +']:' + option.attributes[1].option + ':variation[attribute_pa_'+ option.attributes[2].name +']:' + option.attributes[2].option}}">{{option.attributes[0].option | uppercase}} - {{option.attributes[1].option | uppercase}} - {{option.attributes[2].option | uppercase}} - {{option.price_inc_tax | currency:values.currency:true:'1.2-2'}}
                </ion-option>
              </div>
            </div>
          </ion-select>           
        </ion-item>
      </div>
      
      <div *ngIf="product.product.short_description">
      <ion-item class="item-background">
        요약정보
      </ion-item>
      <ion-item text-wrap  no-lines>
        <div [innerHTML]="product.product.short_description">
        </div>
      </ion-item>
      </div>
      <div *ngIf="product.product.description">
      <ion-item class="item-background">
          상세정보
      </ion-item>
      <ion-item text-wrap  no-lines>
        <div class="product-item-detail" [innerHTML]="product.product.description">
        </div>
      </ion-item>
      </div>
      
      
      <div *ngIf="reviews?.product_reviews.length">
        <ion-row class="item-background">
          <ion-col>
            <button ion-button *ngIf="reviews" color="button-color" button small clear class="review-title">{{"상품후기"}}
            </button>
          </ion-col>
          <ion-col>
          </ion-col>
        </ion-row>

        
        <div  *ngFor="let item of reviews.product_reviews" class="reviews">
            <ion-item no-lines>
              <ion-avatar item-start style="margin:8px">
              <img src="https://www.gravatar.com/avatar/{{item.avatar}}">
              </ion-avatar>
               <h3 style="margin-bottom:6px;font-size:15px">{{item.reviewer_name}}
               <span class="rating review-star">
               <span class="star-icon" [ngClass]="{full: item.rating >= 1, half: item.rating == 0.5}">&#x2605;</span>
               <span class="star-icon" [ngClass]="{full: item.rating >= 2, half: item.rating == 1.5}">&#x2605;</span>
               <span class="star-icon" [ngClass]="{full: item.rating >= 3, half: item.rating == 2.5}">&#x2605;</span>
               <span class="star-icon" [ngClass]="{full: item.rating >= 4, half: item.rating == 3.5}">&#x2605;</span>
               <span class="star-icon" [ngClass]="{full: item.rating >= 5, half: item.rating == 4.5}">&#x2605;</span>
               </span></h3>
      
               <h3 style="color:#9e9898;margin-bottom:4px">{{item.created_at | date:'medium'}}</h3>
            </ion-item>
            <p text-wrap>{{item.review}}</p>
        </div>
      </div>
    </div>

    <br>
  </ion-content>

  <ion-footer no-shadow>
      <ion-toolbar position="bottom">
        <ion-row>
          <button col-3 ion-button full color="dark" text-uppercase [disabled]='disableSubmit' (click)="addToCart(product.product.id)">
            제품문의
          </button>
          <button col-9 ion-button full color="button-color" text-uppercase [disabled]='disableSubmit' (click)="addToCart(product.product.id)">
            구매하기
          </button>
        </ion-row>
      </ion-toolbar>
  </ion-footer>
  
  <!--<div class="add-to-cart-button">
      <button ion-button full color="button-color" text-uppercase [disabled]='disableSubmit' (click)="addToCart(product.product.id)">
        {{AddToCart}}
      </button>
    </div>-->